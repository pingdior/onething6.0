# OneThing AI任务管理应用

这是一个基于AI辅助的个人目标达成伙伴应用，帮助用户更有效地管理目标、任务和情绪。

## 最新更新

- **移动端UI优化**: 全面优化移动端UI，参考设计稿实现更符合移动端使用习惯的界面，添加底部导航栏、优化卡片样式和触控交互。
- **国际化支持增强**: 改进系统语言自动检测功能，支持中文、英文和日文自动切换，UI布局针对不同语言进行自适应优化。
- **移动端AI服务连接修复**: 解决移动端无法连接AI服务的问题，优化API URL构建逻辑和CORS配置，增加服务连接状态提示。
- **React 19兼容性优化**: 解决了React 19与react-beautiful-dnd库的严重兼容性问题，确保应用可以正常运行。
- **服务状态监控**: 新增服务状态监控组件，可实时检测后端和AI服务状态，提升系统稳定性。
- **任务列表重构**: 优化了任务列表组件，采用时间段分组替代拖拽排序，提高了渲染性能。
- **交互功能增强**: 修复任务页面各按钮功能，包括任务添加、编辑、删除和AI讨论功能。
- **聊天记录持久化**: 实现聊天历史的本地存储，解决页面切换后聊天记录丢失的问题。
- **组件间通信机制**: 添加任务与AI讨论的组件间通信机制，实现任务详情自动分析功能。
- **首次使用引导功能**: 新增应用引导流程，帮助用户快速了解系统功能。
- **情绪监测系统实现**: 完整实现情绪监测、记录和分析功能，包括情绪趋势图和分布分析。
- **AI伴侣能力增强**: 重构AI伴侣聊天功能，支持上下文记忆、智能推荐和任务创建。
- **复盘功能实现**: 支持周期性回顾目标和任务完成情况，提供数据分析和改进建议。
- **目标管理系统实现**: 支持创建、查看和管理个人目标，包括子目标分解和进度追踪。
- **任务管理系统重构**: 使用Zustand状态库实现任务数据管理，确保任务数据在AI聊天助手和任务视图之间共享。

## 最新Bug修复与优化记录

### 2025-03-28 移动端优化与BUG修复

#### 移动端UI优化
- ✅ 修复移动端左侧导航栏显示问题，添加更强大的CSS选择器完全隐藏侧边栏
- ✅ 更新应用标题显示，在地址栏正确显示"onething-你的目标达成伙伴"
- ✅ 优化底部导航栏布局，调整为"首页、复盘、对话(中间)、情绪、我的"
- ✅ 将目标页面内容整合至首页底部，减少导航层级
- ✅ 优化中间语音对话按钮样式，替换原先的加号图标

#### API连接问题修复
- ✅ 解决CORS配置冲突：移除前端请求中的`credentials: 'include'`选项，解决与后端`origin: '*'`配置的冲突
- ✅ 统一端口配置：调整API服务端口为5005，与Nginx配置保持一致
- ✅ 改进前端API URL配置，使用相对路径在各种环境下都能正确连接
- ✅ 添加详细的API错误处理和日志记录，便于调试

#### 服务器配置优化
- ✅ 完善MongoDB连接错误处理，在数据库不可用时优雅降级到内存存储
- ✅ 更新服务器CORS配置，支持多种客户端环境
- ✅ 优化API服务健康检查机制，提供更详细的服务状态信息

### 已知问题
- MongoDB连接失败时使用内存存储模式，应用重启后数据不会保留
- 移动设备首次访问可能需要刷新页面以正确应用样式

### 部署注意事项
- 确保服务器安全组和防火墙开放5005端口
- 确保Nginx配置正确代理到Node.js服务（端口5005）
- 服务器重启后需要手动启动Node.js服务：`PORT=5005 node server.js`

## 主要功能

- 📋 智能目标管理与分解
  - 目标设定与截止日期管理
  - 子目标创建与进度追踪
  - 目标优先级排序
  - 完成度可视化展示
- 📆 每日任务规划与追踪
  - 任务创建与管理
  - 时间线与看板视图
  - 任务完成状态追踪
  - 与目标关联功能
  - 任务编辑、删除和AI分析
- 📊 目标复盘与分析
  - 周期性复盘报告
  - 目标进展追踪
  - 时间效率分析
  - 个性化改进建议
- 🧠 情绪监测与干预建议
  - 情绪记录与追踪
  - 情绪趋势分析
  - 情绪与目标/任务关联分析
  - 情绪分布可视化
- 🤖 智能AI伴侣助手
  - 自然语言添加任务
  - 上下文记忆对话
  - 情境感知建议
  - 智能提醒功能
  - 聊天记录持久化存储
- 🔄 自动任务调整与提醒

## 技术栈

- **前端**: React + TypeScript + Tailwind CSS
- **状态管理**: Zustand
- **AI集成**: DeepSeek API / OpenAI API
- **后端**: Node.js + Express
- **数据存储**: 本地状态 + localStorage持久化 (后续会集成数据库)
- **国际化**: i18next + React-i18next
- **响应式设计**: 移动端优化CSS + 设备检测

## 快速开始

1. 安装依赖:
```bash
git clone https://github.com/yourusername/onething.git
cd onething
npm install
```

2. 配置环境变量:
```bash
# 复制环境变量示例文件
cp .env.example .env

# 编辑.env文件，填入你的API密钥
```
> 注意：`.env`文件包含敏感信息，如API密钥等，已在`.gitignore`中配置为不上传到代码仓库。请妥善保管你的API密钥，不要在公开场合分享。

3. 启动后端代理服务:
```bash
node server.js
```

4. 启动前端开发服务器:
```bash
npm start
```

5. 访问应用
前端: http://localhost:3000
GraphQL API: http://localhost:4000/graphql

## 移动端支持
OneThing支持响应式设计，同时适配桌面端和移动端。移动端版本经过特别优化，提供更适合触控操作的界面和交互。特别添加了底部导航栏、移动端专用样式和错误提示，确保在各种移动设备上都能获得出色的用户体验。

## 国际化支持
应用支持多语言切换功能，目前支持中文、英文和日文。系统会自动检测用户设备的语言设置并应用相应的界面语言，同时针对不同语言优化了字体和界面布局，确保在任何语言下都能获得最佳显示效果。

## 功能亮点

### 任务管理增强
- 完整的任务CRUD操作支持
- 任务与AI讨论功能，获取智能分析和建议
- 时间线和看板双视图切换

### 聊天记录持久化
- 使用localStorage保存聊天历史
- 页面刷新和切换后保持对话记忆
- 智能加载之前的对话上下文

### 情绪监测系统
- 支持记录七种基本情绪类型和强度
- 提供情绪趋势分析图表
- 情绪分布饼图展示
- 情绪与目标/任务关联分析

### AI伴侣增强功能
- 上下文记忆对话
- 基于用户情绪和目标推荐回复选项
- 通过自然语言创建任务
- 个性化互动和记忆存储

### 首次使用引导
- 交互式多步骤引导流程
- 直观展示核心功能
- 优化初次用户体验

### 任务与目标深度整合
- 任务可关联到目标
- 目标进度自动根据子目标完成情况更新
- 互联数据确保一致性

## 文件夹结构

```markdown
onething/
├── src/            # 前端源代码目录
│   ├── components/ # UI组件
│   ├── pages/      # 页面组件
│   ├── store/      # Zustand状态管理
│   ├── services/   # API服务
│   ├── i18n/       # 国际化配置和语言文件
│   └── styles/     # 全局样式和移动端专用样式
├── schema/         # GraphQL schema文件
├── scripts/        # 脚本文件
├── public/         # 静态资源
├── server.js       # 后端服务器入口
└── 其他配置文件...
```

## 常见问题解答

### 如何添加新目标?
在目标页面点击"新建目标"按钮，填写目标详细信息后保存即可。

### 如何通过AI助手创建任务?
在AI伴侣对话框中，使用自然语言描述任务，例如"创建任务：明天上午完成项目报告"，AI会自动识别并创建任务。

### 如何编辑或删除任务?
在任务项上悬停时会显示操作菜单，点击"编辑"或"删除"按钮即可。在看板视图中，也可以直接点击对应的操作按钮。

### 如何使用AI分析任务?
点击任务的"与AI讨论"按钮，系统会自动将任务信息发送给AI伴侣进行分析，并提供执行建议。

### 如何查看情绪分析?
在情绪页面可以查看情绪趋势图和分布图，记录日常情绪变化并获取分析洞察。

### 如何生成复盘报告?
在复盘页面选择时间范围（周/月/自定义），点击"生成新复盘"按钮即可创建复盘报告。

### 为什么我的移动设备无法连接AI服务?
如果遇到AI服务连接问题，请确保您的网络连接正常，并尝试刷新页面。如果问题持续存在，可以点击错误提示中的"重试"按钮，或检查服务器是否正常运行。

## 贡献者

- OneThing开发团队
- 创业者Gaya（测试用例提供）
- Claude 3.7 Sonnet (AI辅助开发)

## 版本记录

### v6.0.4 (2025-03-26)
- 全面优化移动端UI设计，实现更符合移动设备使用习惯的界面
- 修复移动端无法连接AI服务的问题
- 增强国际化支持，优化系统语言自动检测和切换
- 添加AI服务连接状态监控和错误提示
- 更新响应式设计，确保在各类移动设备上的最佳显示效果

### v6.0.3 (2025-03-25)
- 修复 Nginx 配置中的重定向循环问题
- 优化 GitHub Actions 部署流程，添加 NODE_ENV 环境变量配置
- 完善 PM2 进程管理配置，解决端口冲突问题
- 更新 DeepSeek API 密钥配置流程
- 改进服务器部署文档和调试记录

### v6.0.2 (2025-03-22)
- 解决React 19与react-beautiful-dnd的严重兼容性问题
- 新增服务状态监控组件，提高系统稳定性
- 重构任务列表组件，优化渲染性能
- 添加新的调试记录文档，方便追踪问题解决过程

### v6.0.1 (2025-03-21)
- 修复任务页面按钮功能问题
- 实现聊天记录持久化
- 添加任务与AI讨论功能
- 改进错误处理和日志

### v6.0.0 (2025-03-20)
- 新增首次使用引导功能
- 实现情绪监测系统
- 增强AI伴侣能力
- 完成复盘功能

### v5.0.0 (2025-03-15)
- 实现目标管理系统
- 任务管理系统重构
- 改进用户界面
- 添加示例数据

## 许可证

MIT © OneThing团队, 2025
